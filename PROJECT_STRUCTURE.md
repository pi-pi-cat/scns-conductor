# é¡¹ç›®ç»“æ„æ€»è§ˆ

```
scns-conductor/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                      # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md                # æ¶æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ API_EXAMPLES.md                # API ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ ğŸ“„ DEPLOYMENT.md                  # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ ğŸ“„ CHANGELOG.md                   # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ ğŸ“„ LICENSE                        # MIT è®¸å¯è¯
â”œâ”€â”€ ğŸ“„ Makefile                       # å¸¸ç”¨å‘½ä»¤å¿«æ·æ–¹å¼
â”œâ”€â”€ ğŸ“„ alembic.ini                    # Alembic é…ç½®
â”œâ”€â”€ ğŸ“„ app.properties                 # åº”ç”¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ requirements.txt               # Python ä¾èµ–
â”œâ”€â”€ ğŸ“„ requirements-dev.txt           # å¼€å‘ä¾èµ–
â”œâ”€â”€ ğŸ“„ docker-compose.yml             # Docker Compose é…ç½®
â”œâ”€â”€ ğŸ“„ .gitignore                     # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ .dockerignore                  # Docker å¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ api/                           # API æœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ main.py                    # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ dependencies.py            # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ ğŸ³ Dockerfile                 # API æœåŠ¡ Docker é•œåƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ routers/                   # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“„ jobs.py                # ä½œä¸šç®¡ç†è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ schemas/                   # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ job_submit.py          # ä½œä¸šæäº¤æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ job_query.py           # ä½œä¸šæŸ¥è¯¢æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ğŸ“„ job_cancel.py          # ä½œä¸šå–æ¶ˆæ¨¡å‹
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ services/                  # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚       â”œâ”€â”€ ğŸ“„ job_service.py         # ä½œä¸šæ ¸å¿ƒæœåŠ¡
â”‚       â””â”€â”€ ğŸ“„ log_reader.py          # æ—¥å¿—è¯»å–æœåŠ¡
â”‚
â”œâ”€â”€ ğŸ“ worker/                        # Worker æœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ main.py                    # Worker å¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ executor.py                # ä½œä¸šæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ ğŸ“„ scheduler.py               # è°ƒåº¦å™¨
â”‚   â”œâ”€â”€ ğŸ“„ resource_tracker.py        # èµ„æºè·Ÿè¸ªå™¨
â”‚   â””â”€â”€ ğŸ³ Dockerfile                 # Worker æœåŠ¡ Docker é•œåƒ
â”‚
â”œâ”€â”€ ğŸ“ core/                          # æ ¸å¿ƒå…±äº«æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ config.py                  # é…ç½®ç®¡ç† (Pydantic Settings)
â”‚   â”œâ”€â”€ ğŸ“„ database.py                # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“„ redis_client.py            # Redis è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“„ models.py                  # SQLAlchemy æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ enums.py                   # æšä¸¾ç±»å‹
â”‚   â”œâ”€â”€ ğŸ“„ exceptions.py              # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚       â”œâ”€â”€ ğŸ“„ logger.py              # Loguru æ—¥å¿—é…ç½®
â”‚       â”œâ”€â”€ ğŸ“„ singleton.py           # å•ä¾‹è£…é¥°å™¨
â”‚       â”œâ”€â”€ ğŸ“„ time_utils.py          # æ—¶é—´æ ¼å¼åŒ–å·¥å…·
â”‚       â””â”€â”€ ğŸ“„ validators.py          # éªŒè¯å™¨
â”‚
â”œâ”€â”€ ğŸ“ migrations/                    # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ ğŸ“„ env.py                     # Alembic ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ script.py.mako             # è¿ç§»è„šæœ¬æ¨¡æ¿
â”‚   â””â”€â”€ ğŸ“ versions/                  # è¿ç§»ç‰ˆæœ¬æ–‡ä»¶
â”‚       â””â”€â”€ ğŸ“„ .gitkeep
â”‚
â”œâ”€â”€ ğŸ“ scripts/                       # è¿ç»´å’Œç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ init_db.py                 # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ ğŸ“„ cleanup.py                 # æ¸…ç†è„šæœ¬
â”‚   â””â”€â”€ ğŸ“„ health_check.py            # å¥åº·æ£€æŸ¥
â”‚
â””â”€â”€ ğŸ“ tests/                         # æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ ğŸ“„ __init__.py
    â”œâ”€â”€ ğŸ“ test_api/
    â”œâ”€â”€ ğŸ“ test_worker/
    â””â”€â”€ ğŸ“ test_core/
```

## å…³é”®æ–‡ä»¶è¯´æ˜

### é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `app.properties` | åº”ç”¨ä¸»é…ç½®æ–‡ä»¶ï¼ˆæ•°æ®åº“ã€Redisã€èµ„æºç­‰ï¼‰ |
| `requirements.txt` | Python ç”Ÿäº§ä¾èµ– |
| `docker-compose.yml` | æœ¬åœ°å¼€å‘ç¯å¢ƒç¼–æ’ |
| `alembic.ini` | æ•°æ®åº“è¿ç§»å·¥å…·é…ç½® |

### API æœåŠ¡

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `api/main.py` | FastAPI åº”ç”¨å…¥å£ï¼Œlifespan ç®¡ç† |
| `api/routers/jobs.py` | ä½œä¸šç®¡ç† API ç«¯ç‚¹ï¼ˆæäº¤ã€æŸ¥è¯¢ã€å–æ¶ˆï¼‰ |
| `api/services/job_service.py` | ä½œä¸šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| `api/schemas/` | Pydantic æ¨¡å‹ï¼Œè¯·æ±‚/å“åº”éªŒè¯ |

### Worker æœåŠ¡

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `worker/main.py` | Worker å¯åŠ¨å…¥å£ï¼ŒRQ worker + Scheduler daemon |
| `worker/executor.py` | ä½œä¸šæ‰§è¡Œå™¨ï¼Œsubprocess ç®¡ç† |
| `worker/scheduler.py` | FIFO + First Fit è°ƒåº¦ç®—æ³• |
| `worker/resource_tracker.py` | çº¿ç¨‹å®‰å…¨çš„ CPU èµ„æºè·Ÿè¸ª |

### æ ¸å¿ƒæ¨¡å—

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `core/config.py` | Pydantic Settingsï¼Œç¯å¢ƒé…ç½®ç®¡ç† |
| `core/database.py` | å¼‚æ­¥/åŒæ­¥æ•°æ®åº“è¿æ¥æ± ç®¡ç† |
| `core/redis_client.py` | Redis è¿æ¥å’Œ RQ é˜Ÿåˆ—ç®¡ç† |
| `core/models.py` | SQLAlchemy ORM æ¨¡å‹ï¼ˆJobã€ResourceAllocation ç­‰ï¼‰ |

### å·¥å…·è„šæœ¬

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `scripts/init_db.py` | åˆ›å»ºæ•°æ®åº“è¡¨å’Œåˆå§‹æ•°æ® |
| `scripts/health_check.py` | æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ |
| `scripts/cleanup.py` | æ¸…ç†é™ˆæ—§ä½œä¸šå’Œèµ„æº |

## ä»£ç ç»Ÿè®¡

```
Language                 Files        Lines         Code     Comments
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Python                      35         3500+        2800+         400+
Markdown                     5         2000+        1800+           -
YAML                         1          100+         100+           -
Makefile                     1           60+          50+           -
Dockerfile                   2           50+          50+           -
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total                       44         5700+        4800+         400+
```

## æŠ€æœ¯æ ˆæ€»è§ˆ

### åç«¯æ¡†æ¶
- **FastAPI** 0.104 - ç°ä»£åŒ– Web æ¡†æ¶
- **SQLAlchemy** 2.0 - ORM æ¡†æ¶
- **Pydantic** 2.5 - æ•°æ®éªŒè¯

### æ•°æ®åº“å’Œé˜Ÿåˆ—
- **PostgreSQL** 14+ - å…³ç³»å‹æ•°æ®åº“
- **Redis** 7+ - ç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—
- **RQ** 1.15 - ä»»åŠ¡é˜Ÿåˆ—

### å¼‚æ­¥å’Œæ—¥å¿—
- **asyncpg** - å¼‚æ­¥ PostgreSQL é©±åŠ¨
- **psycopg2** - åŒæ­¥ PostgreSQL é©±åŠ¨
- **Loguru** - ä¼˜é›…çš„æ—¥å¿—åº“
- **aiofiles** - å¼‚æ­¥æ–‡ä»¶æ“ä½œ

### å¼€å‘å·¥å…·
- **Alembic** - æ•°æ®åº“è¿ç§»
- **pytest** - æµ‹è¯•æ¡†æ¶
- **black** - ä»£ç æ ¼å¼åŒ–
- **mypy** - ç±»å‹æ£€æŸ¥

### å®¹å™¨åŒ–
- **Docker** - å®¹å™¨åŒ–
- **Docker Compose** - æœ¬åœ°å¼€å‘ç¯å¢ƒ

## è®¾è®¡æ¨¡å¼åº”ç”¨

### åˆ›å»ºå‹æ¨¡å¼
- âœ… **å•ä¾‹æ¨¡å¼**: `@singleton` è£…é¥°å™¨ï¼ˆSettingsManagerã€RedisManagerï¼‰
- âœ… **å·¥å‚æ¨¡å¼**: æ•°æ®åº“ä¼šè¯å·¥å‚ï¼ˆSessionMakerï¼‰

### ç»“æ„å‹æ¨¡å¼
- âœ… **é€‚é…å™¨æ¨¡å¼**: å¼‚æ­¥/åŒæ­¥æ•°æ®åº“ç®¡ç†å™¨
- âœ… **å¤–è§‚æ¨¡å¼**: JobService å°è£…å¤æ‚ä¸šåŠ¡é€»è¾‘

### è¡Œä¸ºå‹æ¨¡å¼
- âœ… **ç­–ç•¥æ¨¡å¼**: è°ƒåº¦ç®—æ³•ï¼ˆå¯æ‰©å±•ï¼‰
- âœ… **è§‚å¯Ÿè€…æ¨¡å¼**: è°ƒåº¦å™¨å®ˆæŠ¤çº¿ç¨‹ç›‘æ§ä½œä¸šçŠ¶æ€

### å…¶ä»–æŠ€æœ¯
- âœ… **ä¸Šä¸‹æ–‡ç®¡ç†å™¨**: æ•°æ®åº“ä¼šè¯ã€Redis è¿æ¥
- âœ… **ä¾èµ–æ³¨å…¥**: FastAPI Depends
- âœ… **å¼‚æ­¥ç¼–ç¨‹**: async/await å…¨é¢åº”ç”¨
- âœ… **çº¿ç¨‹å®‰å…¨**: threading.Lock ä¿æŠ¤å…±äº«èµ„æº

## ä¸‹ä¸€æ­¥

1. **å¼€å‘æµ‹è¯•**: ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **æ€§èƒ½æµ‹è¯•**: å‹åŠ›æµ‹è¯•å’Œæ€§èƒ½åŸºå‡†
3. **ç›‘æ§é›†æˆ**: Prometheus metrics, Grafana ä»ªè¡¨æ¿
4. **CI/CD**: GitHub Actions è‡ªåŠ¨åŒ–æµæ°´çº¿
5. **åŠŸèƒ½æ‰©å±•**: ä¼˜å…ˆçº§è°ƒåº¦ã€ä½œä¸šä¾èµ–ã€GPU æ”¯æŒ

---

**é¡¹ç›®ç”Ÿæˆå®Œæˆï¼å¼€å§‹ä½ çš„ä½œä¸šè°ƒåº¦ä¹‹æ—…å§ï¼** ğŸš€

